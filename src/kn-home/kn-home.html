<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/app-layout/app-grid/app-grid-style.html">
<link rel="import" href="../../src/kn-overlay/kn-overlay.html">
<link rel="import" href="../../src/kn-thumbnail/kn-thumbnail.html">
<dom-module id="kn-home">
  <template>
    <iron-ajax auto url='/src/pages.json' handle-as='json' on-response='handleResponse'></iron-ajax>
    <style is="custom-style" include="iron-flex-layout paper-styles app-grid-style">
      :host {
        display: block;
        /*border: 2px solid red;*/
        @apply --layout-vertical;
      }
      .scrollable {
        /*border: 1px solid lightgray;*/
        padding: 24px;
        @apply --layout-scroll;
      }
      .thegrid {
        display: block;
        --app-grid-columns: 3;
        --app-grid-gutter: 60px;
        --app-grid-item-height: 100%;
        margin: 0px 100px;
      }
      .item {
        list-style: none;
        background-color: white;
      }
      @media (max-width: 1200px) {
        .thegrid {
          --app-grid-columns: 2;
          --app-grid-gutter: 60px;
        }

      }
      @media (max-width: 800px) {
        .thegrid {
          --app-grid-columns: 1;
          --app-grid-gutter: 20px;
          margin: 0px 75px;
        }

      }
      .list {
        padding: 0;
        list-style: none;
      }
      .thumbnailImage {
        height: 100%;
        width: 100%;
      }
    </style>
    <div class='thegrid list'>
      <div class='app-grid' has-aspect-ratio>
        <template is='dom-repeat' items='{{pages}}'>
          <kn-thumbnail class='item' on-click='openPreview'>
            <img class='thumbnailImage' src='img/[[item.image]]'>
          </kn-thumbnail>
        </template>
      </div>
    </div>
    <kn-overlay on-close-overlay="closePreview" id="plain" class="with-margin" page="[[selectedProject]]">
      <div class="scrollable">
        [[selectedProject.abstract]]
      </div>
    </kn-overlay>
  </template>
<script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
</dom-module>
<script>
  HTMLImports.whenReady(function() {

    Polymer({

      is: 'kn-home',
      properties: {
        selectedProject: {
          type: Object
        },
        pages: {
          type: Array
        }
      },
      openPreview(event) {
        this.selectedProject = event.model.item;
        this.$.plain.sizingTarget = this.$.plain.querySelector('.scrollable');
        this.$.plain.open();
      },
      closePreview() {
        this.$.plain.close();
      },
      attached: function() {
        this._updateGridStyles = this._updateGridStyles || function() {
          this.updateStyles();
        }.bind(this);
        window.addEventListener('resize', this._updateGridStyles);
      },

      detached: function() {
        window.removeEventListener('resize', this._updateGridStyles);
      },
      handleResponse: function (data) {
        this.pages = data.detail.response;
      }

    });

  });

</script>